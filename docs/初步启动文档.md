# **魔镜 Mirror 颜值 PK 平台项目启动文档**  
**Version 1.0**  

---

## **1. 引言**  
### **1.1 项目背景**  
“魔镜 Mirror 颜值 PK 平台”是一款基于人脸识别技术的娱乐社交 Web 应用，支持用户上传照片进行颜值评分、PK 对战及全球/好友排行榜展示。项目旨在通过融合 AI 技术与社交互动，提升用户参与度，构建趣味性社区生态。  

### **1.2 项目目标**  
- **核心功能**：  
  - 用户注册/登录、照片上传、颜值评分（0-100 分）、PK 对战、排行榜、社交分享。  
- **性能指标**：  
  - 毫秒级人脸检测与评分（响应 <1.5 秒）。  
  - 支持高并发访问（≥1000 QPS）。  
- **技术目标**：  
  - 高精度评分模型（基于 SCUT-FBP5500 数据集优化）。  
  - 可扩展架构设计，支持后续功能迭代。  

### **1.3 项目范围**  
- **覆盖模块**：  
  用户中心、颜值评分、PK 对战、排行榜与分享四大子系统。  
- **技术边界**：  
  前端：Web 应用（React/Vue.js）；后端：Python Flask + C++ 核心算法；数据库：MySQL + Redis。  

---

## **2. 项目组织结构**  
| 角色 | 姓名 | 职责 |  
|------|------|------|  
| **项目经理** | 郑宇风 | 制定计划、协调资源、进度跟踪 |  
| **技术负责人** | 朱哲宁 | 架构设计、核心算法开发 |  
| **前端开发** | 郑宇风 | Web 界面开发、用户交互实现 |  
| **后端开发** | 朱哲宁、樊思宜 | API 开发、数据库设计、评分模块集成 |  
| **测试工程师** | 樊思宜 | 测试用例设计、系统测试与部署 |  

---

## **3. 模块设计**  
### **3.1 用户中心子系统**  
- **功能**：  
  - **注册/登录**：邮箱/用户名密码注册、JWT 认证。  
  - **个人信息管理**：昵称、头像、签名修改。  
  - **历史记录**：查看 PK 历史与分数变化趋势。  
- **技术实现**：  
  - 使用 JWT 实现无状态认证，敏感数据加密存储（Bcrypt）。  

### **3.2 颜值评分子系统**  
- **功能**：  
  - **照片上传**：支持 JPG/PNG 格式，大小 ≤10MB。  
  - **颜值评分**：调用百度 AI 接口（备用方案：自研 CNN 模型）。  
- **技术实现**：  
  - 图像预处理：OpenCV/Dlib 人脸对齐。  
  - 异常处理：未检测到人脸时返回错误提示。  

### **3.3 颜值 PK 对战子系统**  
- **功能**：  
  - **选择对手**：从好友/排行榜中发起挑战。  
  - **胜负判定**：基于分数差值计算积分（ELO 算法）。  
  - **排名更新**：实时更新全球/好友排行榜。  
- **技术实现**：  
  - 使用 Redis 缓存对战结果，异步更新数据库。  

### **3.4 排行榜与分享子系统**  
- **功能**：  
  - **实时榜单**：全球/好友榜单动态排序。  
  - **社交分享**：生成 PK 海报（Canvas），支持微信/微博一键分享。  
- **技术实现**：  
  - 使用 WebSocket 推送排名变化。  

---

## **4. 技术框架设计**  
### **4.1 前端技术栈**  
- **核心框架**：React + TypeScript（兼容移动端响应式布局）。  
- **UI 库**：Ant Design Mobile。  
- **图像处理**：Canvas 实现海报生成。  

### **4.2 后端技术栈**  
- **服务框架**：Python Flask + FastAPI（高性能评分接口）。  
- **核心算法**：  
  - 人脸检测：OpenCV + Dlib。  
  - 评分模型：百度 AI 接口（主用）、自研 CNN 模型（备用）。  
- **并发处理**：Celery + Redis Queue 异步任务队列。  

### **4.3 数据库技术栈**  
- **MySQL**：持久化存储用户、评分记录、PK 历史。  
- **Redis**：缓存实时排名、会话信息、图片路径。  

### **4.4 开发工具**  
- **版本控制**：Git + GitHub 仓库。  
- **CI/CD**：GitHub Actions 自动化测试与部署。  
- **监控**：Prometheus + Grafana 监控服务状态。  

---

## **5. 数据库设计**  
### **5.1 表结构设计**  
#### **用户表（users）**  
| 字段名 | 类型 | 约束 | 描述 |  
|--------|------|------|------|  
| user_id | INT | PK, Auto Increment | 用户唯一标识 |  
| username | VARCHAR(50) | UNIQUE | 用户名 |  
| password_hash | VARCHAR(255) | - | 密码哈希值 |  
| email | VARCHAR(100) | UNIQUE | 邮箱地址 |  
| created_at | DATETIME | DEFAULT NOW() | 注册时间 |  

#### **评分记录表（scores）**  
| 字段名 | 类型 | 约束 | 描述 |  
|--------|------|------|------|  
| score_id | INT | PK, Auto Increment | 记录 ID |  
| user_id | INT | FK(users.user_id) | 关联用户 |  
| image_url | VARCHAR(255) | - | 图片存储路径 |  
| face_score | FLOAT | CHECK(0<=score<=100) | 颜值分数 |  
| scored_at | DATETIME | DEFAULT NOW() | 评分时间 |  

#### **PK 对战表（matches）**  
| 字段名 | 类型 | 约束 | 描述 |  
|--------|------|------|------|  
| match_id | INT | PK, Auto Increment | 对战 ID |  
| challenger_id | INT | FK(users.user_id) | 发起者 ID |  
| opponent_id | INT | FK(users.user_id) | 对手 ID |  
| challenger_score | FLOAT | - | 发起者分数 |  
| opponent_score | FLOAT | - | 对手分数 |  
| result | ENUM('Win','Lose','Tie') | - | 结果 |  
| matched_at | DATETIME | DEFAULT NOW() | 对战时间 |  

### **5.2 E-R 关系图**  
```  
users ┤< scores ┤< matches (双向关联用户与对战记录)  
```  

---

## **6. 接口设计**  
### **6.1 RESTful API 规范**  
- **基础路径**：`https://api.mirror-pk.com/v1`  
- **认证方式**：JWT Bearer Token  

### **6.2 核心接口列表**  
#### **用户注册**  
- **POST /auth/register**  
  - **请求体**：  
    ```json  
    { "username": "user1", "email": "user1@example.com", "password": "Pass123!" }  
    ```  
  - **响应**：  
    ```json  
    { "user_id": 1001, "token": "JWT_TOKEN" }  
    ```  

#### **颜值评分**  
- **POST /scores**  
  - **请求头**：Authorization: Bearer JWT_TOKEN  
  - **请求体**：图片文件（multipart/form-data）  
  - **响应**：  
    ```json  
    { "score": 85.5, "image_url": "https://cdn.example.com/face.jpg" }  
    ```  

#### **发起 PK**  
- **POST /matches**  
  - **请求体**：  
    ```json  
    { "opponent_id": 2002 }  
    ```  
  - **响应**：  
    ```json  
    { "match_id": 5001, "result": "Win", "rank_change": +3 }  
    ```  

---

## **7. 组件设计**  
### **7.1 前端组件**  
- **用户界面**：  
  - `LoginModal`：登录弹窗组件。  
  - `ScoreBoard`：实时排名展示卡片。  
- **交互逻辑**：  
  - Redux 管理全局状态（用户会话、PK 结果）。  

### **7.2 后端组件**  
- **评分服务**：  
  - `FaceDetectionEngine`：封装 OpenCV/Dlib 人脸检测逻辑。  
  - `ScoringModel`：调用百度 AI 接口，失败时回退至本地模型。  
- **PK 引擎**：  
  - `MatchProcessor`：实现 ELO 算法计算积分变化。  

---

## **8. 开发计划**  
| 阶段 | 时间 | 交付物 |  
|------|------|--------|  
| 需求分析 | 2025-06-11 至 2025-06-15 | 需求规格说明书 |  
| 系统设计 | 2025-06-16 至 2025-06-22 | 技术方案、数据库 ER 图 |  
| 开发实施 | 2025-06-23 至 2025-07-01 | 可运行原型 |  
| 测试部署 | 2025-07-02 至 2025-07-05 | 测试报告、部署文档 |  

---

## **9. 风险管理**  
| 风险类型 | 描述 | 应对措施 |  
|----------|------|----------|  
| **技术风险** | 人脸识别精度不足 | 采用混合模型（几何特征+深度学习）迭代优化 |  
| **性能风险** | 高并发下服务崩溃 | Redis 缓存分流 + C++加速核心计算 |  
| **隐私风险** | 用户照片泄露 | 仅存储特征向量，原始图片本地删除 |  

---

## **10. 质量保证**  
- **代码规范**：PEP8（Python）、Airbnb JavaScript Style Guide。  
- **测试策略**：  
  - 单元测试覆盖率 ≥80%（PyTest/Jest）。  
  - 压力测试：JMeter 模拟 1000 用户并发。  

---  
**文档作者**：郑宇风、朱哲宁、樊思宜  
**日期**：2025-06-13